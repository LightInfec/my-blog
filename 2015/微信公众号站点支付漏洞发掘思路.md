
  这几个漏洞给wooyun 都不受理,挖掘的思路跟大家分享一下..



##  从公众号开始发掘

  

  添加完成广州移动的微信公众号之后,下面的选择栏可以进入移动的分站点

 

![图片](pic_temp9\psb1.png)

 

  在分站点里面有很多给用户提供的服务

 

![图片](pic_temp9\psb2.png)

 

  这个页面看起来像是WEB 应用的网页,于是把它的链接复制到PC 端的浏览器上访问



![图片](pic_temp9\psb3.png)

 

  聪明的你肯定看到了99 折话费充值项目,想一想这么多年来移动坑了我不少大洋,于是手痒痒进去看了一下

 

  然后就有今天的主题

 

## 充值漏洞分析

 

  输入好了电话号码和选择好要充值的金额之后,接下来就启动burp 来分析付款的过程



![图片](pic_temp9\psb4.png)

 

  浏览器先会告诉服务端用户需要充值的金额是多少



![图片](pic_temp9\psb5.png)

 

  然后浏览器本地会向支付宝生成付款链接,现在付款申请表达里面的payOrder.totalFee 属性就是支付宝实际向用户收取的费用,于是改为0.10 ,神奇的事情发生了



![图片](pic_temp9\psb6.png)

 

  支付宝现在生成了一个0.10 的现金收取页面,然后浏览器跳到alipay 代收现金

 

![图片](pic_temp9\psb7.jpg)

 

  付款成功之后10086 发来一条亲切的问候.你懂的..



![图片](pic_temp9\psb8.gif)

 

## 中国电信的微信公众号的漏洞利用过程

 

  按照步骤来,第一步还是老规矩输入帐号密码

 

![图片](pic_temp9\psb9.png)

 

  然后不用输入任何验证码就跳到话费充值页面,现在还可以看到绑定到该号码的姓名和话费余额

 

![图片](pic_temp9\psb10.png)

 

  接下来拦截到付款生成的页面链接,修改需要付款的money

 

![图片](pic_temp9\psb11.jpg)

 

  最后就可以达到欺骗生成付款金额的目的啦

 

![图片](pic_temp9\psb12.png)

 

## 服务器逻辑错误

 

  既然谈到这里有必要还得翻出之前发掘出的一个关于众筹网页的支付漏洞,这个漏洞略显奇葩.任意选择一个项目之后就点提交表单.

 

![图片](pic_temp9\psb13.png)



  然后本地页面还会再次根据用户的选择来准备生成付款方式

 

![图片](pic_temp9\psb14.png)



  在正式生成付款链接的时候,浏览器会向服务端提交数据,这个时候是可以把额外支持的金额修改为负数的.



![图片](pic_temp9\psb15.jpg)



  在微信上可以成功付款.

 

![图片](pic_temp9\psb16.png)



## 总结

 

  这本来是一个不应该发生的漏洞,任何关于跨站敏感信息的提交都不应该交给用户的浏览器去做,以此为例子,付款页面应该由后台生成而不是在浏览器本地生成,这样一来用户就拥有了修改任意金额付款的能力..